<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <script src="js/Utils.js"></script>
        <script>


        function Pot( potId, potCapacity, potRules ) 
        {
            this.id          = potID;
            this.capacity    = potCapacity;
            this.rules       = potRules;
            this.currentVolume = 0;
        }


        Pot.prototype.checkRules = function()
        {
            this.failures = [];

            this.rules.forEach( function( ruleToCheck )
            {
                if ( !ruleToCheck( this.currentVolume, this.capacity ) )
                {
                    failures.push( ruleToCheck.failMessage );
                }
            });

            return this.failures.length !== 0;
        };

        

            var inputs = [];
            var elementCache = {};
        	var products = {
        		"1051485":{ 
        		    "name": "name",                    
                    "density": 0.84
                	},
                "1051512":	{
                    "name": "AddDiesel",                    
                    "density": 0.84
                	},
                "1051510": {
				    "name": "UnAddDiesel",                    
                    "density": 0.84
                }
            };

            window.onload = function()
            {


            	var fillButtons = document.querySelectorAll(".fillTanker");
            	var clearButtons = document.querySelectorAll(".clearProduct");

                var inputList = document.querySelectorAll("input");

                elementCache.inputs = [];


                elementCache.currentWeight = document.getElementById('currentWeight');
                elementCache.percWeight = document.getElementById('percWeight');



                for ( var i = 0; i < inputList.length; i++ )
                {                    
                    elementCache.inputs .push({ element:inputList[ i ],
                                                id:     inputList[ i ].id.split("_")[1]});

                    inputList[i].oninput = updateWeight;
                }




            	addClickToNodeList( fillButtons, fillTanker );
            	addClickToNodeList( clearButtons, clearProduct );


                var d = document.getElementById('result');
 
            
             
                Utils.perm([ 1, 2, 3,4,5,6 ], []);
            };

             var maxWeight      = 44000;
             var currentWeight  = 0;

             function addClickToNodeList( list, method )
             {
             	for ( var i = 0; i < list.length; i++ )
             	{
             		list[ i ].onclick = method;
             	}
             }

            function getWeightOfProduct( prodID )
            {
              //  return products[ prodID ].density * 
            }

             function updateWeight()
             {
                currentWeight = 0;

             	elementCache.inputs.forEach( function( input ) 
                {
                    currentWeight += input.element.value * products[ input.id ].density;
                    console.log( currentWeight );
                });

                elementCache.currentWeight.innerHtml = currentWeight + 'kg';
                elementCache.percWeight.innerHtml = ( currentWeight / maxWeight * 100 ) + '%';

             }	

             function clearProduct()
             {
             	var productID = this.parentNode.id.split("_")[1];
                document.querySelector("#input_" + productID ).value = 0;

                updateWeight();
             }

             function fillTanker()
             {
                var productID = this.parentNode.id.split("_")[1];
             	
                document.getElementById( "input_" + productID ).value = 0;

                updateWeight();

             	var density = products[ productID ].density;

             	var liters = ( maxWeight - currentWeight ) / density;

             	document.querySelector("#input_" + productID ).value = Math.floor( liters );

             	updateWeight();
			}

            function potIt()
            {
                var products = [    {type:1051485,capacity:17000},
                                    {type:1051510,capacity:10000},
                                    {type:1051643,capacity:6000}];

                var pots = [ {id:1, capacity:7000, rules:[greaterThan( 6900 )]  }];


            }



        </script>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    </head>
    <body>
    	<div class="wrap">
    		
            <div id="percWeight">0%</div>
            <div id="currentWeight">0kg</div>
    		<form action="">
                <fieldset id="fields_1051485">
                    Unleaded: <input id="input_1051485" oninput="updateWeight" type="text" value="0">
                    <button type="button"  class="fillTanker">Fill</button>
                    <button type="button" class="clearProduct">Clear</button>
                </fieldset>
    			<fieldset id="fields_1051510">
    				Unadditised Diesel: <input id="input_1051510" oninput="updateWeight" type="text" value="0">
    				<button type="button"  class="fillTanker">Fill</button>
    				<button type="button" class="clearProduct">Clear</button>
    			</fieldset>
				<fieldset id="fields_1051512">
    				Additised Diesel: <input id="input_1051512" oninput="updateWeight" type="text" value="0">
    				<button type="button" class="fillTanker">Fill</button>
    				<button type="button" class="clearProduct">Clear</button>
    			</fieldset>
    		</form>
            <div class="potDisplay">
                
                

            </div>

            <div id="result"></div>

    	</div>
        <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->

        <!-- Add your site or application content here -->
        <p>Hello world! This is HTML5 Boilerplate.</p>

        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.10.2.min.js"><\/script>')</script>

        <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
    </body>
</html>